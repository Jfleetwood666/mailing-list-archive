<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="shortcut icon" href="/static/img/favicons/favicon.ico" /><link rel="apple-touch-icon" sizes="57x57" href="/static/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/static/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/static/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/static/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/static/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/static/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/static/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/static/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/static/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/static/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/static/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/static/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/static/img/favicons/favicon-16x16.png"><link rel="manifest" href="/manifest.json"><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><title>cryptoanarchy.wiki - Cypherpunks Mailing List Archive</title><meta name="author" content="cryptoanarchy.wiki" /><meta name="description" content="90be20d6c49f332e815cca2af81845ae6764e4acd41d281c3bb3c0551e10e02e" /><meta name="keywords" content="90be20d6c49f332e815cca2af81845ae6764e4acd41d281c3bb3c0551e10e02e, cryptoanarchy.wiki - Cypherpunks Mailing List Archive, " /><link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml"><meta content="" property="fb:app_id"><meta content="cryptoanarchy.wiki - Cypherpunks Mailing List Archive" property="og:site_name"><meta content="90be20d6c49f332e815cca2af81845ae6764e4acd41d281c3bb3c0551e10e02e" property="og:title"><meta content="article" property="og:type"><meta content="Arise, you have nothing to lose but your barbed wire fences!" property="og:description"><meta content="http://localhost:4000/archive/1997/02/90be20d6c49f332e815cca2af81845ae6764e4acd41d281c3bb3c0551e10e02e/" property="og:url"><meta content="2018-06-21T22:53:40+02:00" property="article:published_time"><meta content="http://localhost:4000/about/" property="article:author"><meta content="http://localhost:4000/static/img/avatar.jpg" property="og:image"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@_cryptoanarchy"><meta name="twitter:creator" content="@_cryptoanarchy"><meta name="twitter:title" content="90be20d6c49f332e815cca2af81845ae6764e4acd41d281c3bb3c0551e10e02e"><meta name="twitter:url" content="http://localhost:4000/archive/1997/02/90be20d6c49f332e815cca2af81845ae6764e4acd41d281c3bb3c0551e10e02e/"><meta name="twitter:description" content="Arise, you have nothing to lose but your barbed wire fences!"><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous"><link rel="stylesheet" href="/static/css/syntax.css"><link href="/static/css/bootstrap.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Roboto+Condensed:400,300italic,300,400italic,700&amp;subset=latin,latin-ext" rel="stylesheet" type="text/css"><link rel="stylesheet" href="/static/css/super-search.css"><link rel="stylesheet" href="/static/css/thickbox.css"><link rel="stylesheet" href="/static/css/projects.css"><link rel="stylesheet" href="/static/css/main.css"><body><div class="container"><div class="col-sm-3"><div class="fixed-condition"> <a href="/"><img class="profile-avatar" src="/static/img/avatar.jpg" height="75px" width="75px" /></a><h1 class="author-name"><a href="/">cryptoanarchy.wiki</a></h1><div class="profile-about"> Arise, you have nothing to lose but your barbed wire fences!</div><div class="social"><ul><li><a href="https://twitter.com/_cryptoanarchy" target="_blank"><i class="fa fa-twitter"></i></a><li><a href="https://www.facebook.com/cryptoanarchy.wiki" target="_blank"><i class="fa fa-facebook"></i></a><li><a href="https://github.com/cryptoanarchywiki" target="_blank"><i class="fa fa-github"></i></a></ul></div><hr /><ul class="sidebar-nav"> <strong>Navigation</strong><li><a href="https://cryptoanarchy.wiki">Return to cryptoanarchy.wiki</a><li><a href="/">Archive Home</a></ul><hr><ul class="sidebar-nav"> <strong>Similar Resources</strong><li><a class="about" href="https://lopp.net/bitcoin.html" target="_blank">Lopp's Bitcoin Resources</a><li><a class="about" href="https://nakamotoinstitute.org/" target="_blank">Satoshi Nakamoto Institute</a><li><a class="about" href="https://www.activism.net/cypherpunk/" target="_blank">Activism.net: Cypherpunks</a></ul></div></div><div class="col-sm-8 col-offset-1 main-layout"><h1 id="1997-02-13---re-distributed-mailing-list-architecture">1997-02-13 - Re: distributed mailing list architecture</h1><h2 id="header-data">Header Data</h2><p>From: Thomas Roessler &lt;Thomas.Roessler@sobolev.rhein.de&gt;<br /> To: cypherpunks@toad.com<br /> Message Hash: 90be20d6c49f332e815cca2af81845ae6764e4acd41d281c3bb3c0551e10e02e<br /> Message ID: &lt;199702131958.LAA09891@toad.com&gt;<br /> Reply To: <em>N/A</em><br /> UTC Datetime: 1997-02-13 19:58:56 UTC<br /> Raw Date: Thu, 13 Feb 1997 11:58:56 -0800 (PST)<br /><h2 id="raw-message">Raw message</h2><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>From: Thomas Roessler &lt;Thomas.Roessler@sobolev.rhein.de&gt;
Date: Thu, 13 Feb 1997 11:58:56 -0800 (PST)
To: cypherpunks@toad.com
Subject: Re: distributed mailing list architecture
Message-ID: &lt;199702131958.LAA09891@toad.com&gt;
MIME-Version: 1.0
Content-Type: text/plain


Maybe you have some use for the appended perl script.  I created it for a
list setup quite similar to what is currently being discussed on
cypherpunks.  It has never ever been used in production; you'll notice
yourself that the code is not too nice.

The script currently tries to handle majordomo and SmartList exploders; at
least SmartList needs to be hacked a little bit to avoid daily subscription
approvals to people being moved between different sub-lists.

Distribute and use this script freely; credit is appreciated.

tlr
------------------------------
#!/usr/bin/perl

############################################################
#
# $Id: distlist.pl,v 1.2 1997/01/24 17:20:38 roessler Exp $
#

#
# Handle distributed mailing lists.
#

require 'getopts.pl';

$c_sublists='lists';		# Data about the sublists
$c_distfile='dist';		# A list of mail addresses
$c_datafile='dist.data';	# _Our_ list of addresses
$c_contact='roessler@sobolev.rhein.de';
				# Whom to contact in case of problems
$sendmail="| /usr/sbin/sendmail -t -odq";


$debug=0;			# Debugging output.  Can also be
				# turned on by using the -x switch.

$signature="-- \nThis mail has been generated automatically by the distlist\n".
    "program. Please contact $c_contact in case of problems.\n";


@sublists=();
@newsubs=();

#
# Command line processing
#

&amp;dprint (1, 'Processing the command line...\n');
&amp;Getopts('s:d:D:c:x:');

$c_sublists=$opt_s if $opt_s;
$c_distfile=$opt_d if $opt_d;
$c_datafile=$opt_D if $opt_D;
$c_contact=$opt_c  if $opt_c;
$debug=$opt_x	   if $opt_x;

#
# Read the data and config files, perform various checks.
#

#
# sublists
#

&amp;dprint(1, "Reading $c_sublists...");

# format: addr:maxsubscr:listtype:password:adminrequest:maintainer

open(SUBLISTS, $c_sublists) || die("Can't open $c_sublists");
SUBLIST: while(&lt;SUBLISTS&gt;) {
    next SUBLIST if /^#/ || /^$/;
    chop;
    ($addr, $maxsubscr, $listtype, $password, $admin, $maintainer) = split(/:/, $_);
    $s_maxsubscr{$addr}=$maxsubscr;
    $s_listtype{$addr}=$listtype;
    $s_password{$addr}=$password;
    $s_admin{$addr}=$admin;
    $s_maintainer{$addr}=$maintainer;
    $s_onlist{$addr}=0;
    $s_addem{$addr}="";
    $s_delem{$addr}="";
    &amp;dprint(3,"Parsed list $addr: maximum $maxsubscr people; listtype $listtype; password $password.; administrative address $admin; maintainer $maintainer");
    @sublists=(@sublists, $addr);
}

close(SUBLISTS);

# In addition, we define a special list for people to be redistributed later.

$s_maxsubscr{'later'}=100000;		# Very big. ;)
$s_listtype{'later'}="";
$s_password{'later'}="";
$s_onlist{'later'}=0;
$s_addem{'later'}="";
$s_delem{'later'}="";

#
# Read our dist file
#



# format: user:list

if(open(DATAFILE, $c_datafile)) {
    &amp;dprint(1, "Reading $c_datafile...");

  USERLINE: while(&lt;DATAFILE&gt;) {
      next USERLINE if /^#/ || /^$/;
      chop;
      ($user, $list) = split(/:/, $_);
      
      # Check if the list exists; handle user.
      
      if(! $s_maxsubscr{$list}) {
	  &amp;dprint(2, "While checking user $user:  $list does no longer exist.");
	  $list="later";
      } elsif( $s_onlist{$list} &gt;= $s_maxsubscr{$list} ) {
	  &amp;dprint(2, "Warning: $list is full.  Redistributing people later.");
	  $s_delem{$list}=join(':',$user,$s_delem{$list});
	  $list="later";
      } 
      
      $s_onlist{$list}++;
      $u_list{$user}=$list;
      
      $deletem{$user}=$user;
  }
    
    close(DATAFILE);
    &amp;dprint(1,"$c_datafile finished.");
} else {
    &amp;dprint(1, "Warning:  Can't read $c_datafile.");
}


#
# Now, read the real distribution file.
#

&amp;dprint(1, "Reading $c_distfile...");

open(DISTFILE, $c_distfile) || die("Can't open $c_distfile");

 DISTLINE: while(&lt;DISTFILE&gt;) {
     next DISTLINE if /^#/ || /^$/ || /^\(/;
     chop;
     
     if(!$u_list{$_}) {			# A new member.
	 &amp;dprint(2, "Found a new member: $_.");
	 @newsubs=($_, @newsubs);
     } else {				# We know him.
	 &amp;dprint(3, "Well-known: $_.");
	 delete $deletem{$_};
     }
     
 }

close(DISTFILE);


#
# Handle deletions.
#

foreach $user (keys %deletem) {
    $list=$u_list{$user};
    delete $u_list{$user};
    $s_onlist{$list}--;
    $s_delem{$list}=join(':', $s_delem{$list}, $user);
    &amp;dprint(3, "Removing $user from sublist $list.");
}

#
# Handle postponed subscriptions:  The later list.
#

foreach (keys %u_list) {
    next unless $u_list{$_} eq "later";
    @newsubs=($_, @newsubs);
    delete $u_list{$_};
    &amp;dprint(3, "Adding $_ to the list of new subscriptions.  Was postponed.");
}


&amp;dprint(1, "Distributing new subscriptions...");

 NEWSUBS: foreach $user (@newsubs) {

     $avg=0.0;
     foreach $l (@sublists) {
	 $avg += $s_onlist{$l}/$s_maxsubscr{$l};
     }
     
     $avg = $avg / ($#sublists + 1.0);
     
     if ($avg &gt;= 1) {
	 &amp;dprint(2, "Warning: All sublists are full while trying to insert $user.");
     }

     undef $possible;

     foreach $l (@sublists) {
	 if($s_onlist{$l} &lt;= $avg*$s_maxsubscr{$l}) {
	     $possible=$l;
	 }

	 if($s_onlist{$l} &lt; $avg*$s_maxsubscr{$l}) {
	     last;
	 }
     }

     if($possible) {
	 $l = $possible;
     }
     
     $s_addem{$l}=join(':', $s_addem{$l}, $user);
     $s_onlist{$l}++;
     $u_list{$user}=$l;
     
 }

#
# Write our own data file.
#

if(open(DATAFILE, "&gt;$c_datafile")) {
    foreach (keys %u_list) {
	printf DATAFILE "%s:%s\n", $_, $u_list{$_};
    }
    close(DATAFILE);
} else {
    &amp;dprint(1, "Warning: Can't write $c_datafile.");
}

#
# The lists have been put together.  Commit the changes.
#

&amp;dprint(1, "Committing the changes...");

foreach $l (@sublists) {
    if($s_listtype{$l} eq "majordomo") {
	&amp;commit_majordomo($l);
    } elsif ($s_listtype{$l} eq "smartlist") {
	&amp;commit_smartlist($l);
    } else {
	&amp;dprint(1, "While trying to commit changes for $l:");
	&amp;dprint(1, "Unknown list type $s_listtype{$l}.\n");
    }
}

#
# To be done:  Print out some statistics.
#

print "Distlist results:\n";
print "-----------------\n";
print "\n";
printf "There are currently %d subscribers on %d sublists.\n\n", scalar(keys %u_list), $#sublists+1;

$full_lists=0;

printf "%-40s     on  max\n", "Name";
printf "----------------------------------------------------\n";

foreach $l (@sublists) {
    printf "%-40s   %4d %4d", $l, $s_onlist{$l}, $s_maxsubscr{$l};
    
    if($s_onlist{$l} &gt;= $s_maxsubscr{$l}) {
	print "   *** This list is full ***";
	$full_lists++;
    }

    print "\n";
}

if($full_lists) {
    print "\n$full_lists of the sublists are *full*.  Please get in touch\n";
    print "with the maintainers.\n";
}

print "\n\n";
print $signature;

############################################################
#
# Some helper functions.
#

# Print out diagnostics.

sub dprint
{
    if($_[0] &lt;= $debug) {
	printf STDERR "%s\n", $_[1];
    }
}


sub commit_majordomo
{
    my $list=$_[0];
    my @bla;
    my $ll;
    my $user;

    &amp;dprint(2, "Committing changes to majordomo list $list");
    &amp;dprint(3, "to be added: $s_addem{$list}");
    &amp;dprint(3, "to be deleted: $s_delem{$list}");

    ($ll, @bla)=split(/@/, $list);

    if(!open(SENDMAIL, $sendmail)) {
	&amp;dprint(1, "Warning:  Can't start sendmail when committing changes to $list");
    }

    print SENDMAIL "To: $s_admin{$list}\n";
    print SENDMAIL "From: $c_contact\n";
    print SENDMAIL "\n\n";
    
    foreach $user (@bla=split(/:/, $s_addem{$list})) {
	print SENDMAIL "approve $s_password{$list} subscribe $ll $user\n"
	    if $u_list{$user};
    }

    foreach $user (@bla=split(/:/, $s_delem{$list})) {
	print SENDMAIL "approve $s_password{$list} unsubscribe $ll $user\n"
	    unless $u_list{$user} eq $list;
    }

    print SENDMAIL $signature;
    
    close(SENDMAIL);
}

sub smartlist_xcommand
{
    my ($list, $to, $passwd, $command, $maintainer) = @_;

    if(!open(SENDMAIL, $sendmail)) {
	&amp;dprint(1, "Can't start sendmail when committing changes for $list");
    }

    print SENDMAIL "To: $to\n";
    print SENDMAIL "From: $c_contact\n";
    print SENDMAIL "X-Command: $maintainer $passwd $command\n";
    print SENDMAIL "\n\n";
    print SENDMAIL $signature;

    close SENDMAIL;
}	
	
    

sub commit_smartlist
{
    my $list=$_[0];
    my @bla;
    my $user;

    &amp;dprint(2, "Committing changes to smartlist list $list");
    
    foreach $user (@bla=split(/:/, $s_addem{$list})) {
	&amp;smartlist_xcommand($list, $s_admin{$list}, $s_password{$list},
			    "subscribe $user", $s_maintainer{$list})
	    if $u_list{$user};
    }

    foreach $user (@bla=split(/:/, $s_delem{$list})) {
	&amp;smartlist_xcommand($list, $s_admin{$list}, $s_password{$list},
			    "unsubscribe $user", $s_maintainer{$list})
	    unless $u_list{$user} eq $list;
    }
}







</code></pre></div></div><h2 id="thread">Thread</h2><ul><li><p>Return to <a href="/archive/1997/02">February 1997</a><li><p>1997-02-13 (Thu, 13 Feb 1997 11:58:56 -0800 (PST)) - Re: distributed mailing list architecture - <em>Thomas Roessler &lt;Thomas.Roessler@sobolev.rhein.de&gt;</em></ul><footer> - <a href="https://github.com/cryptoanarchywiki/mailing-list-archive">https://github.com/cryptoanarchywiki/mailing-list-archive</a></footer></div></div><script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script> <script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script> <script src="/static/js/bootstrap.min.js"></script> <script src="/static/js/super-search.js"></script> <script src="/static/js/thickbox-compressed.js"></script> <script src="/static/js/projects.js"></script>
