<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="shortcut icon" href="/static/img/favicons/favicon.ico" /><link rel="apple-touch-icon" sizes="57x57" href="/static/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/static/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/static/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/static/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/static/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/static/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/static/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/static/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/static/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/static/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/static/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/static/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/static/img/favicons/favicon-16x16.png"><link rel="manifest" href="/manifest.json"><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><title>cryptoanarchy.wiki - Cypherpunks Mailing List Archive</title><meta name="author" content="cryptoanarchy.wiki" /><meta name="description" content="9892bc6491aa3265f829e21de793f7e6b9417fb34b4f33436e2defe324b1fe48" /><meta name="keywords" content="9892bc6491aa3265f829e21de793f7e6b9417fb34b4f33436e2defe324b1fe48, cryptoanarchy.wiki - Cypherpunks Mailing List Archive, " /><link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml"><meta content="" property="fb:app_id"><meta content="cryptoanarchy.wiki - Cypherpunks Mailing List Archive" property="og:site_name"><meta content="9892bc6491aa3265f829e21de793f7e6b9417fb34b4f33436e2defe324b1fe48" property="og:title"><meta content="article" property="og:type"><meta content="Arise, you have nothing to lose but your barbed wire fences!" property="og:description"><meta content="http://localhost:4000/archive/1995/09/9892bc6491aa3265f829e21de793f7e6b9417fb34b4f33436e2defe324b1fe48/" property="og:url"><meta content="2018-06-27T00:58:45+02:00" property="article:published_time"><meta content="http://localhost:4000/about/" property="article:author"><meta content="http://localhost:4000/static/img/avatar.jpg" property="og:image"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@_cryptoanarchy"><meta name="twitter:creator" content="@_cryptoanarchy"><meta name="twitter:title" content="9892bc6491aa3265f829e21de793f7e6b9417fb34b4f33436e2defe324b1fe48"><meta name="twitter:url" content="http://localhost:4000/archive/1995/09/9892bc6491aa3265f829e21de793f7e6b9417fb34b4f33436e2defe324b1fe48/"><meta name="twitter:description" content="Arise, you have nothing to lose but your barbed wire fences!"><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous"><link rel="stylesheet" href="/static/css/syntax.css"><link href="/static/css/bootstrap.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Roboto+Condensed:400,300italic,300,400italic,700&amp;subset=latin,latin-ext" rel="stylesheet" type="text/css"><link rel="stylesheet" href="/static/css/super-search.css"><link rel="stylesheet" href="/static/css/thickbox.css"><link rel="stylesheet" href="/static/css/projects.css"><link rel="stylesheet" href="/static/css/main.css"><body><div class="container"><div class="col-sm-3"><div class="fixed-condition"> <a href="/"><img class="profile-avatar" src="/static/img/avatar.jpg" height="75px" width="75px" /></a><h1 class="author-name"><a href="/">cryptoanarchy.wiki</a></h1><div class="profile-about"> Arise, you have nothing to lose but your barbed wire fences!</div><div class="social"><ul><li><a href="https://twitter.com/_cryptoanarchy" target="_blank"><i class="fa fa-twitter"></i></a><li><a href="https://www.facebook.com/cryptoanarchy.wiki" target="_blank"><i class="fa fa-facebook"></i></a><li><a href="https://github.com/cryptoanarchywiki" target="_blank"><i class="fa fa-github"></i></a></ul></div><hr /><ul class="sidebar-nav"> <strong>Navigation</strong><li><a href="https://cryptoanarchy.wiki">Return to cryptoanarchy.wiki</a><li><a href="/">Archive Home</a><li><a href="/archive/">Posts by Year</a><li><a href="/authors/by-posts/">Authors by Post Number</a><li><a href="/authors/notable/">Notable Authors</a></ul><hr><ul class="sidebar-nav"> <strong>Similar Resources</strong><li><a class="about" href="https://lopp.net/bitcoin.html" target="_blank">Lopp's Bitcoin Resources</a><li><a class="about" href="https://nakamotoinstitute.org/" target="_blank">Satoshi Nakamoto Institute</a><li><a class="about" href="https://www.activism.net/cypherpunk/" target="_blank">Activism.net: Cypherpunks</a></ul></div></div><div class="col-sm-8 col-offset-1 main-layout"><h1 id="1995-09-08---re-fast-modular-reduction">1995-09-08 - Re: fast modular reduction</h1><h2 id="header-data">Header Data</h2><p>From: Ray Cromwell &lt;rjc<span>@</span>clark.net&gt;<br /> To: weidai@eskimo.com (Wei Dai)<br /> Message Hash: 9892bc6491aa3265f829e21de793f7e6b9417fb34b4f33436e2defe324b1fe48<br /> Message ID: &lt;199509080048.UAA19561@clark.net&gt;<br /> Reply To: &lt;Pine.SUN.3.91.950907131638.6760C-100000@eskimo.com&gt;<br /> UTC Datetime: 1995-09-08 00:49:09 UTC<br /> Raw Date: Thu, 7 Sep 95 17:49:09 PDT<br /><h2 id="raw-message">Raw message</h2><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>From: Ray Cromwell &lt;rjc@clark.net&gt;
Date: Thu, 7 Sep 95 17:49:09 PDT
To: weidai@eskimo.com (Wei Dai)
Subject: Re: fast modular reduction
In-Reply-To: &lt;Pine.SUN.3.91.950907131638.6760C-100000@eskimo.com&gt;
Message-ID: &lt;199509080048.UAA19561@clark.net&gt;
MIME-Version: 1.0
Content-Type: text/plain



&gt; 
&gt; The numbers you give are a bit off.  Assuming a 32-bit machine,
&gt; n=64 implies a 2048-bit modulus, and a 4096-bit number to be reduced. 
&gt; Also, Karatsuba should use 1/3 (2*64^1.58 / 64^2) the multiplications
&gt; rather than 1/5. 

The n=64 implies two 2048-bit numbers are being multiplied. The 2048-bit
number comes from the fact that in a typical crypto app, modexp
will be reducing numbers as large as the modulus squared which runs
2048-bits for a 1024-bit modulus. The reciprocal is 1 block
bigger than the number to be reduced. Hence, you are dealing with
multiplying about two 2048-bit numbers. But since we only care
about the "fractional" part of the result, we can safely throw
away half the computation and only compute half the Karatsuba
recursion tree. (the number before the decimal point is the
quotient) Then, to determine the final remainder, we simply
multiply by the modulus again, throwing away non-significant
computation again. There is a normal n^2 method for reducing
via reciprocal that only uses 1/4 the number of ops as the obvious
technique.

Your right about the 1/3 vs 1/5, I dunno where the 5 came from, must
have been a typo in my calcs. The problem with Karatsuba is that it's
hard to implement efficiently. Temporary ints should be kept to
a minimum and be preallocated. The combine step requires 1 store,
and 5 additions, of multiprecision integers. The split step requires
no copying if you use pointer manipulation, and instead of shifting,
don't add in place, but add "with shift" to the destination. Most
of the implementations I've seen do too much copying and shifting.

Given that some modern processors have efficient hardware multiply,
it might not be worth all the trouble to trade mults for adds. If
a processor has an efficient hardware FFT, it might even be worthwhile
to use the FFT multiply method.

Do you have a ref for the Montgomery method? I'm unfamilar with
the name, I wonder if it's something I've seen before under
a different label.

Check out Schonhage's book "Fast Algorithms" They've implemented
all the asymtotic algorithms efficiently and gathered
performance data. I corresponded with Schonhage's grad student
and he told me that Karatsuba wins for n&gt;=8, which I find difficult
to see, when it takes about n=32 for my own implementation (not
optimized) to break even.

-Ray





 









</code></pre></div></div><h2 id="thread">Thread</h2><ul><li><p>Return to <a href="/archive/1995/09">September 1995</a><li>Return to “<a href="/author/ray_cromwell_rjc_at_clark_net_">Ray Cromwell &lt;rjc<span>@</span>clark.net&gt;</a>”<li><p>Return to “<a href="/author/wei_dai_weidai_at_eskimo_com_">Wei Dai &lt;weidai<span>@</span>eskimo.com&gt;</a>”<li>1995-09-07 (Wed, 6 Sep 95 17:48:44 PDT) - <a href="/archive/1995/09/7e0463fae13c529cd6ffd0c4185357c2909b2f5ad1cee9fd0ead4b7f3e13fa62">fast modular reduction</a> - <em>Wei Dai &lt;weidai@eskimo.com&gt;</em><ul><li>1995-09-07 (Wed, 6 Sep 95 18:58:17 PDT) - <a href="/archive/1995/09/484653f811cb04804fc78fdeaad538b587647e0a3f495f05655c4a2ff76b5f16">Re: fast modular reduction</a> - <em>Ray Cromwell &lt;rjc@clark.net&gt;</em><ul><li>1995-09-07 (Thu, 7 Sep 95 01:14:50 PDT) - <a href="/archive/1995/09/0002ca37bb8b9ffa98cee0e3b31c175d351060c6144aa835cba0ab45e106c8e2">Re: fast modular reduction</a> - <em>Ray Cromwell &lt;rjc@clark.net&gt;</em><ul><li>1995-09-07 (Thu, 7 Sep 95 16:47:38 PDT) - <a href="/archive/1995/09/278288d20f6f0bea8f236f674ebcd9749cf40dbf30b76d79f88261eee4d4b0f1">Re: fast modular reduction</a> - <em>Wei Dai &lt;weidai@eskimo.com&gt;</em><ul><li>1995-09-08 (Thu, 7 Sep 95 17:49:09 PDT) - Re: fast modular reduction - <em>Ray Cromwell &lt;rjc@clark.net&gt;</em></ul></ul></ul></ul></ul><footer> - <a href="https://github.com/cryptoanarchywiki/mailing-list-archive">https://github.com/cryptoanarchywiki/mailing-list-archive</a></footer></div></div><script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script> <script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script> <script src="/static/js/bootstrap.min.js"></script> <script src="/static/js/super-search.js"></script> <script src="/static/js/thickbox-compressed.js"></script> <script src="/static/js/projects.js"></script>
