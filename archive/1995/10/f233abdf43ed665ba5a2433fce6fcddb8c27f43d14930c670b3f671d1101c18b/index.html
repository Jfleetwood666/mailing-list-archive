<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="shortcut icon" href="/static/img/favicons/favicon.ico" /><link rel="apple-touch-icon" sizes="57x57" href="/static/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/static/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/static/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/static/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/static/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/static/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/static/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/static/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/static/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/static/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/static/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/static/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/static/img/favicons/favicon-16x16.png"><link rel="manifest" href="/manifest.json"><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><title>cryptoanarchy.wiki - Cypherpunks Mailing List Archive</title><meta name="author" content="cryptoanarchy.wiki" /><meta name="description" content="F233abdf43ed665ba5a2433fce6fcddb8c27f43d14930c670b3f671d1101c18b" /><meta name="keywords" content="F233abdf43ed665ba5a2433fce6fcddb8c27f43d14930c670b3f671d1101c18b, cryptoanarchy.wiki - Cypherpunks Mailing List Archive, " /><link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml"><meta content="" property="fb:app_id"><meta content="cryptoanarchy.wiki - Cypherpunks Mailing List Archive" property="og:site_name"><meta content="F233abdf43ed665ba5a2433fce6fcddb8c27f43d14930c670b3f671d1101c18b" property="og:title"><meta content="article" property="og:type"><meta content="Arise, you have nothing to lose but your barbed wire fences!" property="og:description"><meta content="http://localhost:4000/archive/1995/10/f233abdf43ed665ba5a2433fce6fcddb8c27f43d14930c670b3f671d1101c18b/" property="og:url"><meta content="2018-06-23T00:09:03+02:00" property="article:published_time"><meta content="http://localhost:4000/about/" property="article:author"><meta content="http://localhost:4000/static/img/avatar.jpg" property="og:image"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@_cryptoanarchy"><meta name="twitter:creator" content="@_cryptoanarchy"><meta name="twitter:title" content="F233abdf43ed665ba5a2433fce6fcddb8c27f43d14930c670b3f671d1101c18b"><meta name="twitter:url" content="http://localhost:4000/archive/1995/10/f233abdf43ed665ba5a2433fce6fcddb8c27f43d14930c670b3f671d1101c18b/"><meta name="twitter:description" content="Arise, you have nothing to lose but your barbed wire fences!"><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous"><link rel="stylesheet" href="/static/css/syntax.css"><link href="/static/css/bootstrap.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Roboto+Condensed:400,300italic,300,400italic,700&amp;subset=latin,latin-ext" rel="stylesheet" type="text/css"><link rel="stylesheet" href="/static/css/super-search.css"><link rel="stylesheet" href="/static/css/thickbox.css"><link rel="stylesheet" href="/static/css/projects.css"><link rel="stylesheet" href="/static/css/main.css"><body><div class="container"><div class="col-sm-3"><div class="fixed-condition"> <a href="/"><img class="profile-avatar" src="/static/img/avatar.jpg" height="75px" width="75px" /></a><h1 class="author-name"><a href="/">cryptoanarchy.wiki</a></h1><div class="profile-about"> Arise, you have nothing to lose but your barbed wire fences!</div><div class="social"><ul><li><a href="https://twitter.com/_cryptoanarchy" target="_blank"><i class="fa fa-twitter"></i></a><li><a href="https://www.facebook.com/cryptoanarchy.wiki" target="_blank"><i class="fa fa-facebook"></i></a><li><a href="https://github.com/cryptoanarchywiki" target="_blank"><i class="fa fa-github"></i></a></ul></div><hr /><ul class="sidebar-nav"> <strong>Navigation</strong><li><a href="https://cryptoanarchy.wiki">Return to cryptoanarchy.wiki</a><li><a href="/">Archive Home</a></ul><hr><ul class="sidebar-nav"> <strong>Similar Resources</strong><li><a class="about" href="https://lopp.net/bitcoin.html" target="_blank">Lopp's Bitcoin Resources</a><li><a class="about" href="https://nakamotoinstitute.org/" target="_blank">Satoshi Nakamoto Institute</a><li><a class="about" href="https://www.activism.net/cypherpunk/" target="_blank">Activism.net: Cypherpunks</a></ul></div></div><div class="col-sm-8 col-offset-1 main-layout"><h1 id="1995-10-30---re-devrandom-for-freebsd-was-re-devrandom-for-linux">1995-10-30 - Re: /dev/random for FreeBSD [was: Re: /dev/random for Linux]</h1><h2 id="header-data">Header Data</h2><p>From: “Theodore Ts’o” &lt;tytso@MIT.EDU&gt;<br /> To: Mark Murray &lt;mark@grondar.za&gt;<br /> Message Hash: f233abdf43ed665ba5a2433fce6fcddb8c27f43d14930c670b3f671d1101c18b<br /> Message ID: &lt;9510302225.AA25562@dcl.MIT.EDU&gt;<br /> Reply To: &lt;199510302148.XAA00832@grumble.grondar.za&gt;<br /> UTC Datetime: 1995-10-30 23:47:22 UTC<br /> Raw Date: Tue, 31 Oct 1995 07:47:22 +0800<br /><h2 id="raw-message">Raw message</h2><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">From</span><span class="p">:</span> <span class="s2">"Theodore Ts'o"</span> <span class="p">&lt;</span><span class="n">tytso</span><span class="p">@</span><span class="n">MIT</span><span class="p">.</span><span class="n">EDU</span><span class="p">&gt;</span>
<span class="n">Date</span><span class="p">:</span> <span class="n">Tue</span><span class="p">,</span> <span class="m">31</span> <span class="n">Oct</span> <span class="m">1995</span> <span class="m">07</span><span class="p">:</span><span class="m">47</span><span class="p">:</span><span class="m">22</span> <span class="p">+</span><span class="m">0800</span>
<span class="k">To</span><span class="p">:</span> <span class="n">Mark</span> <span class="n">Murray</span> <span class="p">&lt;</span><span class="n">mark</span><span class="p">@</span><span class="n">grondar</span><span class="p">.</span><span class="n">za</span><span class="p">&gt;</span>
<span class="n">Subject</span><span class="p">:</span> <span class="n">Re</span><span class="p">:</span> <span class="p">/</span><span class="n">dev</span><span class="p">/</span><span class="nb">random</span> <span class="n">for</span> <span class="n">FreeBSD</span> <span class="p">[</span><span class="n">was</span><span class="p">:</span> <span class="n">Re</span><span class="p">:</span> <span class="p">/</span><span class="n">dev</span><span class="p">/</span><span class="nb">random</span> <span class="n">for</span> <span class="n">Linux</span><span class="p">]</span>
<span class="k">In</span><span class="p">-</span><span class="n">Reply</span><span class="p">-</span><span class="k">To</span><span class="p">:</span> <span class="p">&lt;</span><span class="m">199510302148.</span><span class="n">XAA00832</span><span class="p">@</span><span class="n">grumble</span><span class="p">.</span><span class="n">grondar</span><span class="p">.</span><span class="n">za</span><span class="p">&gt;</span>
<span class="n">Message</span><span class="p">-</span><span class="n">ID</span><span class="p">:</span> <span class="p">&lt;</span><span class="m">9510302225.</span><span class="n">AA25562</span><span class="p">@</span><span class="n">dcl</span><span class="p">.</span><span class="n">MIT</span><span class="p">.</span><span class="n">EDU</span><span class="p">&gt;</span>
<span class="n">MIME</span><span class="p">-</span><span class="k">Version</span><span class="p">:</span> <span class="m">1.0</span>
<span class="n">Content</span><span class="p">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">text</span><span class="p">/</span><span class="n">plain</span>


   <span class="n">Date</span><span class="p">:</span> <span class="n">Mon</span><span class="p">,</span> <span class="m">30</span> <span class="n">Oct</span> <span class="m">1995</span> <span class="m">23</span><span class="p">:</span><span class="m">48</span><span class="p">:</span><span class="m">24</span> <span class="p">+</span><span class="m">0200</span>
   <span class="k">From</span><span class="p">:</span> <span class="n">Mark</span> <span class="n">Murray</span> <span class="p">&lt;</span><span class="n">mark</span><span class="p">@</span><span class="n">grondar</span><span class="p">.</span><span class="n">za</span><span class="p">&gt;</span>

   <span class="p">&gt;</span> <span class="n">Secondly</span><span class="p">,</span> <span class="n">making</span> <span class="p">/</span><span class="n">dev</span><span class="p">/</span><span class="nb">random</span> <span class="n">only</span> <span class="n">readable</span> <span class="n">by</span> <span class="s2">"privileged programs"</span>
   <span class="p">&gt;</span> <span class="n">means</span> <span class="n">that</span> <span class="n">people</span> <span class="n">won</span><span class="s1">'t be able to compile their own version of PGP that
   &gt; can take advantage of the random number generator.  Instead, they would
   &gt; have to use a setuid version of PGP, and I'</span><span class="n">m</span> <span class="n">quite</span> <span class="n">sure</span> <span class="n">PGP</span> <span class="n">wasn</span><span class="s1">'t
   &gt; written such that it would be safe to turn on its setuid bit.  

   How about SetGID? We were going for 660 root.kmem.

Bad idea; anyone who can run PGP could then get instant access to kmem

	cd /tmp
	ln -s /dev/kmem foo
	pgp -e tytso foo
	rm foo
	pgp foo.pgp

   &gt; Again, /dev/random can be set to whatever permissions the system
   &gt; administrator wants.  Secondly, writing to /dev/random merely adds
   &gt; randomness to the pool, via the mixing algorithm.  It won'</span><span class="n">t</span> <span class="n">actually</span>
   <span class="p">&gt;</span> <span class="n">permit</span> <span class="n">people</span> <span class="k">to</span> <span class="p">*</span><span class="k">set</span><span class="p">*</span> <span class="n">the</span> <span class="n">state</span> <span class="k">of</span> <span class="n">the</span> <span class="n">pool</span><span class="p">,</span> <span class="k">and</span> <span class="n">assuming</span> <span class="n">that</span> <span class="n">the</span>
   <span class="p">&gt;</span> <span class="n">state</span> <span class="k">of</span> <span class="n">the</span> <span class="n">pool</span> <span class="n">is</span> <span class="k">not</span> <span class="n">known</span> <span class="n">before</span> <span class="n">the</span> <span class="nb">write</span> <span class="n">operation</span><span class="p">,</span> <span class="n">writing</span> <span class="k">to</span> <span class="n">it</span>
   <span class="p">&gt;</span> <span class="n">won</span><span class="s1">'t allow the user to know what the state is after the write
   &gt; operation.

   What happens if some attacker does:

   for (;;) {
	   write_to_devrandom(NULL);
	   check_to_see_if_state_is_crackable();
   }

   ? "Gut feel" suggests to me that large ammounts of "predicted" input might
   be worse than the normal sort of system noise you have been using.

But keep in mind that what we'</span><span class="n">re</span> <span class="n">doing</span> <span class="n">is</span> <span class="n">XOR</span><span class="s1">'ing the input data into
the pool.  (Actually, it'</span><span class="n">s</span> <span class="n">a</span> <span class="n">bit</span> <span class="n">more</span> <span class="n">complicated</span> <span class="n">than</span> <span class="n">that</span><span class="p">.</span>  <span class="n">The</span> <span class="n">input</span>
<span class="n">is</span> <span class="n">XOR</span><span class="s1">'ed in with a CRC-like function, generated by taking an
irreducible polynomial in GF(2**128).  But for the purposes of this
argument, you can think of it as XOR.)  So since you don'</span><span class="n">t</span> <span class="n">know</span> <span class="n">what</span> <span class="n">the</span>
<span class="n">input</span> <span class="n">state</span> <span class="k">of</span> <span class="n">the</span> <span class="n">pool</span> <span class="n">is</span><span class="p">,</span> <span class="n">you</span> <span class="n">won</span><span class="s1">'t know what the output state of the
pool.

Also, you never get to see the actual state of the pool, even when you
read out numbers from /dev/random.  What you'</span><span class="n">re</span> <span class="n">getting</span> <span class="n">is</span> <span class="n">a</span> <span class="p">*</span><span class="n">hash</span><span class="p">*</span> <span class="k">of</span>
<span class="n">the</span> <span class="n">pool</span><span class="p">.</span>  <span class="n">So</span> <span class="k">if</span> <span class="n">you</span> <span class="n">can</span> <span class="n">actually</span> <span class="n">implement</span>
<span class="n">check_to_see_if_state_is_crackable</span><span class="p">(),</span> <span class="k">then</span> <span class="n">you</span><span class="s1">'ve found a weakness in
MD5 (or SHA, to which I'</span><span class="n">ll</span> <span class="n">probably</span> <span class="n">be</span> <span class="n">switching</span> <span class="k">in</span> <span class="n">the</span> <span class="n">near</span> <span class="n">future</span><span class="p">).</span>

   <span class="p">&gt;</span> <span class="k">And</span><span class="p">,</span> <span class="n">for</span> <span class="n">race</span> <span class="n">condition</span> <span class="n">reasons</span><span class="p">,</span> <span class="n">something</span> <span class="n">which</span> <span class="n">I</span> <span class="n">need</span> <span class="k">to</span> <span class="n">implement</span>
   <span class="p">&gt;</span> <span class="n">soon</span> <span class="n">is</span> <span class="n">an</span> <span class="n">ioctl</span><span class="p">(),</span> <span class="n">usuable</span> <span class="n">only</span> <span class="n">by</span> <span class="n">root</span><span class="p">,</span> <span class="n">that</span> <span class="n">simultaneously</span> <span class="n">updates</span>
   <span class="p">&gt;</span> <span class="n">the</span> <span class="n">entropy</span> <span class="n">estimate</span> <span class="p">*</span><span class="k">and</span><span class="p">*</span> <span class="n">submits</span> <span class="n">data</span> <span class="k">to</span> <span class="n">be</span> <span class="n">mixed</span> <span class="n">into</span> <span class="n">the</span> <span class="n">pool</span><span class="p">.</span>  <span class="p">(</span><span class="n">Why</span>
   <span class="p">&gt;</span> <span class="n">this</span> <span class="n">is</span> <span class="n">necessary</span> <span class="n">should</span> <span class="n">be</span> <span class="n">obvious</span> <span class="n">after</span> <span class="n">a</span> <span class="n">few</span> <span class="n">minutes</span> <span class="n">thought</span><span class="p">.)</span>

   <span class="n">Clue</span> <span class="n">me</span> <span class="k">in</span> <span class="p">-</span> <span class="n">I</span><span class="s1">'m not quite with you? :-)

Consider this scenario:

1)  Process one writes randomness to /dev/random.

2)  Process two immediately consumes a large amount of randomness using
/dev/urandom, so that the effective randomness is now zero.

3)  Process two uses the ioctl() to bump the entropy count by the amount
of randomness added in step 1.  Unfortunately, that entropy was already
consumed in step 2.

   &gt; I didn'</span><span class="n">t</span> <span class="n">say</span> <span class="n">that</span> <span class="n">it</span> <span class="n">would</span> <span class="n">be</span> <span class="n">trivial</span> <span class="n">for</span> <span class="n">an</span> <span class="n">attacker</span> <span class="k">to</span> <span class="k">do</span> <span class="n">this</span><span class="p">,</span> <span class="n">but</span>
   <span class="p">&gt;</span> <span class="n">it</span><span class="s1">'s certainly *doable*.  Some of the network traffic analyzers that
   &gt; have been made available (I think Sandia National Labs has one that does
   &gt; this), records down to millisecond accuracy when a packet was sniffed on
   &gt; the network.  

   Is this millisecond accuracy quantifiable in terms of bits of entropy?
   if so, the ethernet is surely safe?

Well, no.  If you'</span><span class="n">re</span> <span class="n">only</span> <span class="n">using</span> <span class="k">as</span> <span class="n">your</span> <span class="n">timing</span> <span class="n">the</span> <span class="m">100</span><span class="n">Hz</span> <span class="n">clock</span><span class="p">,</span> <span class="n">the</span>
<span class="n">adversary</span> <span class="n">will</span> <span class="n">have</span> <span class="n">a</span> <span class="n">better</span> <span class="n">timebase</span> <span class="n">than</span> <span class="n">you</span> <span class="k">do</span><span class="p">.</span>  <span class="n">So</span> <span class="n">you</span> <span class="n">may</span> <span class="n">be</span> <span class="n">adding</span>
<span class="n">zero</span> <span class="k">or</span> <span class="n">even</span> <span class="n">no</span> <span class="n">bits</span> <span class="k">of</span> <span class="n">entropy</span> <span class="n">which</span> <span class="n">can</span><span class="s1">'t be deduced by the adversary.

This is even worse in the PGP keyboard timing case, since the adversary
almost certainly can find a better time resolution to measure your
incoming packets when compared to the timing resolution that most
programs have.  Far too many Unix systems only make a 100Hz clock
available to the user mode, even if you have a better quality high
resolution timing device in the kernel (for example, the Pentium cycle
counting register).

   Again, if you can quantify the number of possibilities into bits of entropy,
   your code is good. Depending on current technology, this may have to change.

The problem is that in order to do this requires making assumptions
about what the capabilities of your adversary are.  Not only does this
change over time, but certain adversaries (like the NSA) make it their
business to conceal their capabilities, for precisely this reason.

So I like to be conservative and use limits which are imposed by the
laws of physics, as opposed to the current level of technology.  Hence,
if the packet arrival time can be observed by an outsider, you are at
real risk in using the network interrupts as a source of entropy.
Perhaps it requires buidling a very complicated model of how your Unix
scheduler works, and how much time it takes to process network packets,
etc.  ---- but I have to assume that an adversary can very precisely
model that, if they were to work hard enough at it.

People may disagree as to whether or not this is possible, but it'</span><span class="n">s</span> <span class="k">not</span>
<span class="n">prevented</span> <span class="n">by</span> <span class="n">the</span> <span class="n">laws</span> <span class="k">of</span> <span class="n">physics</span><span class="p">;</span> <span class="n">merely</span> <span class="n">by</span> <span class="n">how</span> <span class="n">much</span> <span class="n">effort</span> <span class="n">someone</span>
<span class="n">might</span> <span class="n">need</span> <span class="k">to</span> <span class="n">put</span> <span class="k">in</span> <span class="k">to</span> <span class="n">be</span> <span class="n">able</span> <span class="k">to</span> <span class="k">model</span> <span class="n">a</span> <span class="n">particular</span> <span class="n">operating</span> <span class="nf">system</span><span class="s1">'s
networking code.  In any case, that'</span><span class="n">s</span> <span class="n">why</span> <span class="n">I</span> <span class="n">don</span><span class="s1">'t like depending on
network interrupts.  Your paranoia level may vary.

						- Ted





</span></code></pre></div></div><h2 id="thread">Thread</h2><ul><li>Return to <a href="/archive/1995/10">October 1995</a><li><p>Return to <a href="/archive/1995/11">November 1995</a><li>1995-10-30 (Tue, 31 Oct 1995 07:36:57 +0800) - <a href="/archive/1995/10/84c08cbceaab83ba959f32fa5ad5a1a16a9a18c3734e4cb00f9ad086c6d6b6d5">Re: /dev/random for FreeBSD [was: Re: /dev/random for Linux]</a> - <em>Mark Murray &lt;mark@grondar.za&gt;</em><ul><li>1995-10-30 (Tue, 31 Oct 1995 07:47:22 +0800) - Re: /dev/random for FreeBSD [was: Re: /dev/random for Linux] - <em>“Theodore Ts’o” &lt;tytso@MIT.EDU&gt;</em><li>1995-10-31 (Tue, 31 Oct 1995 11:36:57 +0800) - <a href="/archive/1995/10/150733ad0d2ecc69da882c7c06d8a8ebb8f0162bb3d10a4cb9dd6c281f818c96">Re: /dev/random for FreeBSD [was: Re: /dev/random for Linux]</a> - <em>“Josh M. Osborne” &lt;stripes@va.pubnix.com&gt;</em><ul><li>1995-10-31 (Tue, 31 Oct 1995 11:52:56 +0800) - <a href="/archive/1995/10/a1eb6592d3c887b7bf88cbe4571b82fc733c60e5c7df66c4d232e7430ebba67b">Re: /dev/random for FreeBSD [was: Re: /dev/random for Linux]</a> - <em>“Theodore Ts’o” &lt;tytso@MIT.EDU&gt;</em><ul><li>1995-10-31 (Wed, 1 Nov 1995 02:56:13 +0800) - <a href="/archive/1995/10/72c6dfea72fc241311fb344fe0559b7ac1238d7c83a4453dbf4a865af646c891">Re: /dev/random for FreeBSD [was: Re: /dev/random for Linux]</a> - <em>Mike_Spreitzer.PARC@xerox.com</em><ul><li>1995-11-02 (Thu, 2 Nov 1995 10:32:40 +0800) - <a href="/archive/1995/11/b8e5cd44d4f7cd677d01a813184ca7dc17d1e93b3a34ab7bc7de0343f1c9bae0">Re: /dev/random for FreeBSD [was: Re: /dev/random for Linux]</a> - <em>sdw@lig.net (Stephen D. Williams)</em></ul></ul></ul></ul></ul><footer> - <a href="https://github.com/cryptoanarchywiki/mailing-list-archive">https://github.com/cryptoanarchywiki/mailing-list-archive</a></footer></div></div><script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script> <script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script> <script src="/static/js/bootstrap.min.js"></script> <script src="/static/js/super-search.js"></script> <script src="/static/js/thickbox-compressed.js"></script> <script src="/static/js/projects.js"></script>
