<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="shortcut icon" href="/static/img/favicons/favicon.ico" /><link rel="apple-touch-icon" sizes="57x57" href="/static/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/static/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/static/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/static/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/static/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/static/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/static/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/static/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/static/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/static/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/static/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/static/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/static/img/favicons/favicon-16x16.png"><link rel="manifest" href="/manifest.json"><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><title>cryptoanarchy.wiki - Cypherpunks Mailing List Archive</title><meta name="author" content="cryptoanarchy.wiki" /><meta name="description" content="7f69d7b3a9456d04c710d046fe9bfde8b73f5cb26f626c28dfd3953cbe408e9b" /><meta name="keywords" content="7f69d7b3a9456d04c710d046fe9bfde8b73f5cb26f626c28dfd3953cbe408e9b, cryptoanarchy.wiki - Cypherpunks Mailing List Archive, " /><link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml"><meta content="" property="fb:app_id"><meta content="cryptoanarchy.wiki - Cypherpunks Mailing List Archive" property="og:site_name"><meta content="7f69d7b3a9456d04c710d046fe9bfde8b73f5cb26f626c28dfd3953cbe408e9b" property="og:title"><meta content="article" property="og:type"><meta content="Arise, you have nothing to lose but your barbed wire fences!" property="og:description"><meta content="http://localhost:4000/archive/1996/05/7f69d7b3a9456d04c710d046fe9bfde8b73f5cb26f626c28dfd3953cbe408e9b/" property="og:url"><meta content="2018-06-27T00:58:45+02:00" property="article:published_time"><meta content="http://localhost:4000/about/" property="article:author"><meta content="http://localhost:4000/static/img/avatar.jpg" property="og:image"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@_cryptoanarchy"><meta name="twitter:creator" content="@_cryptoanarchy"><meta name="twitter:title" content="7f69d7b3a9456d04c710d046fe9bfde8b73f5cb26f626c28dfd3953cbe408e9b"><meta name="twitter:url" content="http://localhost:4000/archive/1996/05/7f69d7b3a9456d04c710d046fe9bfde8b73f5cb26f626c28dfd3953cbe408e9b/"><meta name="twitter:description" content="Arise, you have nothing to lose but your barbed wire fences!"><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous"><link rel="stylesheet" href="/static/css/syntax.css"><link href="/static/css/bootstrap.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Roboto+Condensed:400,300italic,300,400italic,700&amp;subset=latin,latin-ext" rel="stylesheet" type="text/css"><link rel="stylesheet" href="/static/css/super-search.css"><link rel="stylesheet" href="/static/css/thickbox.css"><link rel="stylesheet" href="/static/css/projects.css"><link rel="stylesheet" href="/static/css/main.css"><body><div class="container"><div class="col-sm-3"><div class="fixed-condition"> <a href="/"><img class="profile-avatar" src="/static/img/avatar.jpg" height="75px" width="75px" /></a><h1 class="author-name"><a href="/">cryptoanarchy.wiki</a></h1><div class="profile-about"> Arise, you have nothing to lose but your barbed wire fences!</div><div class="social"><ul><li><a href="https://twitter.com/_cryptoanarchy" target="_blank"><i class="fa fa-twitter"></i></a><li><a href="https://www.facebook.com/cryptoanarchy.wiki" target="_blank"><i class="fa fa-facebook"></i></a><li><a href="https://github.com/cryptoanarchywiki" target="_blank"><i class="fa fa-github"></i></a></ul></div><hr /><ul class="sidebar-nav"> <strong>Navigation</strong><li><a href="https://cryptoanarchy.wiki">Return to cryptoanarchy.wiki</a><li><a href="/">Archive Home</a><li><a href="/archive/">Posts by Year</a><li><a href="/authors/by-posts/">Authors by Post Number</a><li><a href="/authors/notable/">Notable Authors</a></ul><hr><ul class="sidebar-nav"> <strong>Similar Resources</strong><li><a class="about" href="https://lopp.net/bitcoin.html" target="_blank">Lopp's Bitcoin Resources</a><li><a class="about" href="https://nakamotoinstitute.org/" target="_blank">Satoshi Nakamoto Institute</a><li><a class="about" href="https://www.activism.net/cypherpunk/" target="_blank">Activism.net: Cypherpunks</a></ul></div></div><div class="col-sm-8 col-offset-1 main-layout"><h1 id="1996-05-21---protocol-encrypted-open-books">1996-05-21 - PROTOCOL: Encrypted Open Books</h1><h2 id="header-data">Header Data</h2><p>From: tcmay<span>@</span>got.net (Timothy C. May)<br /> To: cypherpunks@toad.com<br /> Message Hash: 7f69d7b3a9456d04c710d046fe9bfde8b73f5cb26f626c28dfd3953cbe408e9b<br /> Message ID: &lt;adc6b62a1a02100403da@[205.199.118.202]&gt;<br /> Reply To: <em>N/A</em><br /> UTC Datetime: 1996-05-21 11:43:46 UTC<br /> Raw Date: Tue, 21 May 1996 19:43:46 +0800<br /><h2 id="raw-message">Raw message</h2><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>From: tcmay@got.net (Timothy C. May)
Date: Tue, 21 May 1996 19:43:46 +0800
To: cypherpunks@toad.com
Subject: PROTOCOL: Encrypted Open Books
Message-ID: &lt;adc6b62a1a02100403da@[205.199.118.202]&gt;
MIME-Version: 1.0
Content-Type: text/plain



Wei Dai wrote:

"There is indeed a short section in the Cyphernomicon about encrypted open
books.  Unfortunately it doesn't describe it in detail, and since the
hks.net archive is down, I can't look up Eric Hughes' original e-mail on
the topic.  If anyone has a copy of it in his personal archive, please
repost it.  I'm sure other people would be interested as well."

Your wish is my command!


&gt;Date: Mon, 16 Aug 93 13:57:51 -0700
&gt;From: Eric Hughes &lt;hughes@soda.berkeley.edu&gt;
&gt;To: cypherpunks@toad.com
&gt;Subject: PROTOCOL: Encrypted Open Books
&gt;Status: OR
&gt;
&gt;Kent Hastings wondered how an offshore bank could provide assurances
&gt;to depositors.  I wondered the same thing a few months ago, and
&gt;started working on what Perry calls the anonymous auditing problem.  I
&gt;have what I consider to be the core of a solution.
&gt;
&gt;All the following protocols and ideas are in the public domain.
&gt;
&gt;The following is long.
&gt;
&gt;My notation here will also be much less formal than I am capable of; I
&gt;don't want to make the uninitiated read TeX.
&gt;
&gt;The basic idea is that summation can be performed encrypted by using
&gt;exponentiation in a finite field.  That is, if I represent an amount x
&gt;by g^x and an amount y by g^y, then I can compute the sum of x and y
&gt;by multiplying g^x and g^y, getting g^(x+y).  Very basic.
&gt;
&gt;So let us take a very simple version of this protocol, which leaves
&gt;out many desiderata.  If a shared funds account, say, has a bunch of
&gt;transactions made on it, then we can publish each of those amounts x_i
&gt;(for the non-TeX'd, underscore means subscript) encrypted as g^(x_i).
&gt;I know what my transaction number, i, is, and what the amount was, so
&gt;I can verify that my transaction appeared in the public list.  We also
&gt;publish the beginning and ending balances, givings use a total
&gt;difference X.  Now anyone can verify that g^X equals g^(Sum_i x_i).
&gt;That is, everyone can verify that the aggregate effect of the
&gt;transactions is what is claimed without revealing the amounts of any
&gt;of them.
&gt;
&gt;What does this protocol reveal?  It reveals the number of transactions
&gt;on each account and thus the total number of transactions.  It is also
&gt;subject to known plaintext attack.  If I get an account on this system
&gt;and make one transaction in each amount, I can decrypt by table lookup
&gt;the whole transaction flow.  The total number of transaction accounts
&gt;is also revealed, or, for a bank, the number of customers.
&gt;
&gt;We can easily solve the known plaintext attack by blinding each
&gt;transaction.  Instead of publishing pairs &lt;i, g^(x_i)&gt;, we have for
&gt;each transaction a blinding factor r_i and publish triples
&gt;
&gt;        &lt;i, g^(x_i + r_i), h^(r_i)&gt;
&gt;
&gt;The notation has grown.  g is a generator of a finite field G, and h
&gt;is a generator of a different finite field H.
&gt;
&gt;We also publish R = Sum_i r_i in addition to X = Sum_i x_i.
&gt;
&gt;What is the public verification procedure?  Basically the same as the
&gt;first case, but in addition taking into account the blinding factors.
&gt;
&gt;Step 1.  Calculate Product_i h^(r_i) and make sure that it equals h^R.
&gt;This validates the blinding factors.
&gt;
&gt;Step 2.  Calculate Product_i g^(x_i + r_i) and make sure that it
&gt;equals g^(X+R).  This, given the validity of the blinding factors,
&gt;validates the actual transactions.
&gt;
&gt;How does this resist known plaintext attack?  Since the blinding
&gt;factors r_i are flatly distributed over their range (caveat! you pick
&gt;the order of G smaller than of H to assure this), the x_i + r_i sum
&gt;acts exactly as a one-time pad to encrypt the amount.  In summary,
&gt;what is going on here is that both the messages (amounts) and the keys
&gt;(the blinding factors) are being sent out as images of one-way
&gt;functions (exponentiations) that preserve exactly the relationships
&gt;that we want.
&gt;
&gt;There's more.  For a real business, we want to keep double entry books
&gt;and not just single entry accounts as above.  By extending the number
&gt;of terms in the transaction, we can do that too.  In double entry
&gt;bookkeeping, the total amounts for each transaction must sum to zero
&gt;over the various accounts being transacted upon; I say this knowing
&gt;that when you print out the information for an accountant you'll have
&gt;to do some sign twiddling for the asset and liability/equity halves of
&gt;the books.  Also, a single transaction may involve more than two
&gt;accounts, even if in practice most involve only two.
&gt;
&gt;The basic idea here is that each transaction is a set of the above
&gt;transactions whose sum must be zero.  So for a transaction i, we publish
&gt;a set of triples, indexed by j,
&gt;
&gt;        &lt; T_i,j, g^( m_i,j + r_i,j ), h^( r_i,j ) &gt;
&gt;
&gt;where the subscripts are doubly indexed and where T_i,j represents the
&gt;account that amount m_i,j is changing.  Now we can perform, on each
&gt;transaction, the following very similar verification procedure for
&gt;each fixed i.
&gt;
&gt;Step 1.  Verify that Product_j h^( r_i,j ) = 1.  This verifies that
&gt;the blinding factors sum to zero.
&gt;
&gt;Step 2.  Verify that Product_j g^( m_i,j + r_i,j ) = 1.  Since the
&gt;blinding factors sum to zero, this ensures that the transaction
&gt;amounts sum to zero.
&gt;
&gt;Not that both of these sums are done over j, not i.  In other words,
&gt;we validate each transaction individually.
&gt;
&gt;Now we also publish aggregate changes in the public accounts just as
&gt;before.  The holders of private accounts know what how their accounts
&gt;have changed.  Then we can use the the single account verification
&gt;method as above to verify that the totals match.  Everyone can verify
&gt;that the public accounts match, and the holders of private accounts
&gt;can verify that they match.
&gt;
&gt;To summarize: The transactions are doubly indexed.  If you group by
&gt;transaction, then you verify that each transaction sums to zero.  If
&gt;you group by account, then you verify that the change in that account
&gt;is as expected, be it public or private.
&gt;
&gt;In the scenario that Kent originally proposed, one of the public
&gt;accounts would be a gold account, which through independent public
&gt;auditing would be verified to be accurate.  I personally would not use
&gt;gold but rather denominate certain accounts in shares of mutual funds,
&gt;which are resistant to the currency inflations of mining and stockpile
&gt;sales.
&gt;
&gt;What information is still being disclosed?  The most worrisome to me
&gt;is that the total number of transactions per account is revealed, that
&gt;is, aggregate activity, but not total money flux.  I have an insight
&gt;that may allow the _account_ to be blinded as well as the amounts, and
&gt;be revealed in aggregate just as the amounts are, but I have not
&gt;worked out the details because I am not fully up to speed on the
&gt;relevant math.
&gt;
&gt;BEGIN BIG MATH
&gt;I only expect a few people to follow the next paragraphs, so if you
&gt;don't understand it, skip it.
&gt;
&gt;Here's the idea.  The modular exponentiation is performed in a finite
&gt;ring.  We choose a ring that has lots of distinct prime ideals of
&gt;sufficiently large order.  To each account we assign one ideal.  We
&gt;represent dollar amounts as elements of this ideal; since the ideal is
&gt;prime, this is straightforward.  The property of the ideal we use is
&gt;that the sum of any two elements of the ideal is also in the ideal.
&gt;Hence by partitioning the ring, we also partition the computation of
&gt;the accounts.  We are blinding the transcations by account because we
&gt;rely on the fact that blinding is not an intra-ideal operation, and
&gt;thus does not preserve that invariant, which would otherwise be
&gt;public.
&gt;
&gt;We must be careful not to allow operations that would result in an
&gt;element which was in the intersection of two ideals.  This requires
&gt;upper bounds both on the transaction amount and on the number of
&gt;transactions per cycle.  There might be rings of order p^n+1 which
&gt;would be suitable for this operations, but I am not sure of the
&gt;security of the discrete log in such cases, except for p=2, in which
&gt;case it is bad.
&gt;
&gt;END OF BIG MATH
&gt;
&gt;The protocol as specified, though, is useful as it stands.  I have not
&gt;specified all the details.  For example the blinding factors should
&gt;likely be created in a cooperative protocol at the point of
&gt;transaction; blinding factors for intra-bank transactions should not
&gt;contain subliminal channels.  Certificates of deposit and withdrawal
&gt;should be tied to the published transaction information.  Etc.
&gt;Remember, this is the core of an idea.
&gt;
&gt;One criticism I do wish to address now.  I don't think it matters if
&gt;the bank manufactures fake transactions.  The customer can reveal the
&gt;sum of all the blinding factors for transactions on that account, in
&gt;public, and can thus prove what should have been there.  Since the
&gt;blinding factors were committed to in public, there is a strong
&gt;assurance that these blinding factors are what they are claimed to be.
&gt;This in itself can be made into an actual proof of liability.  Note
&gt;that even this revelantion does not compromise individual
&gt;transactions.  It only reveals the aggregate value change, which is
&gt;exactly what is at issue with the bank.
&gt;
&gt;On the other hand, all of the bank assets that are held external to
&gt;that organization can be externally audited in the same way.  The
&gt;other institutions that hold money might be persuaded to undertake a
&gt;legal obligation to honor what the encrypted open books say they
&gt;should have; this may not be difficult because they can verify that
&gt;their record of the transactions matches what has been published.
&gt;
&gt;If we use the contents of the encrypted books at the organizational
&gt;boundary points to create suitable legal opbligations, we can mostly
&gt;ignore what goes on inside of the mess of random numbers.  That is,
&gt;even if double books were being kept, the legal obligations created
&gt;should suffice to ensure that everything can be unwound if needed.
&gt;This doesn't prevent networks of corrupt businesses from going down
&gt;all at once, but it does allow networks of honest businesses to
&gt;operate with more assurance of honesty.
&gt;
&gt;Eric







</code></pre></div></div><h2 id="thread">Thread</h2><ul><li><p>Return to <a href="/archive/1996/05">May 1996</a><li>Return to “<a href="/author/daw_at_cs_berkeley_edu_david_wagner_">daw<span>@</span>cs.berkeley.edu (David Wagner)</a>”<li><p>Return to “<a href="/author/tcmay_at_got_net_timothy_c_may_">tcmay<span>@</span>got.net (Timothy C. May)</a>”<li>1996-05-21 (Tue, 21 May 1996 19:43:46 +0800) - PROTOCOL: Encrypted Open Books - <em>tcmay@got.net (Timothy C. May)</em><ul><li>1996-05-23 (Thu, 23 May 1996 15:29:40 +0800) - <a href="/archive/1996/05/fc13a39e29ee33925d62c62e54d77c98ae52e6b48b737cb5b964c29bf43aea21">Re: PROTOCOL: Encrypted Open Books</a> - <em>daw@cs.berkeley.edu (David Wagner)</em></ul></ul><footer> - <a href="https://github.com/cryptoanarchywiki/mailing-list-archive">https://github.com/cryptoanarchywiki/mailing-list-archive</a></footer></div></div><script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script> <script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script> <script src="/static/js/bootstrap.min.js"></script> <script src="/static/js/super-search.js"></script> <script src="/static/js/thickbox-compressed.js"></script> <script src="/static/js/projects.js"></script>
