<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="shortcut icon" href="/static/img/favicons/favicon.ico" /><link rel="apple-touch-icon" sizes="57x57" href="/static/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/static/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/static/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/static/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/static/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/static/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/static/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/static/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/static/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/static/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/static/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/static/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/static/img/favicons/favicon-16x16.png"><link rel="manifest" href="/manifest.json"><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><title>cryptoanarchy.wiki - Cypherpunks Mailing List Archive</title><meta name="author" content="cryptoanarchy.wiki" /><meta name="description" content="A771e069ec125795bf977029a69eb89aba61e044d3f04677c74dcb1dbee011e9" /><meta name="keywords" content="A771e069ec125795bf977029a69eb89aba61e044d3f04677c74dcb1dbee011e9, cryptoanarchy.wiki - Cypherpunks Mailing List Archive, " /><link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml"><meta content="" property="fb:app_id"><meta content="cryptoanarchy.wiki - Cypherpunks Mailing List Archive" property="og:site_name"><meta content="A771e069ec125795bf977029a69eb89aba61e044d3f04677c74dcb1dbee011e9" property="og:title"><meta content="article" property="og:type"><meta content="Arise, you have nothing to lose but your barbed wire fences!" property="og:description"><meta content="http://localhost:4000/archive/1998/07/a771e069ec125795bf977029a69eb89aba61e044d3f04677c74dcb1dbee011e9/" property="og:url"><meta content="2018-06-27T00:58:45+02:00" property="article:published_time"><meta content="http://localhost:4000/about/" property="article:author"><meta content="http://localhost:4000/static/img/avatar.jpg" property="og:image"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@_cryptoanarchy"><meta name="twitter:creator" content="@_cryptoanarchy"><meta name="twitter:title" content="A771e069ec125795bf977029a69eb89aba61e044d3f04677c74dcb1dbee011e9"><meta name="twitter:url" content="http://localhost:4000/archive/1998/07/a771e069ec125795bf977029a69eb89aba61e044d3f04677c74dcb1dbee011e9/"><meta name="twitter:description" content="Arise, you have nothing to lose but your barbed wire fences!"><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous"><link rel="stylesheet" href="/static/css/syntax.css"><link href="/static/css/bootstrap.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Roboto+Condensed:400,300italic,300,400italic,700&amp;subset=latin,latin-ext" rel="stylesheet" type="text/css"><link rel="stylesheet" href="/static/css/super-search.css"><link rel="stylesheet" href="/static/css/thickbox.css"><link rel="stylesheet" href="/static/css/projects.css"><link rel="stylesheet" href="/static/css/main.css"><body><div class="container"><div class="col-sm-3"><div class="fixed-condition"> <a href="/"><img class="profile-avatar" src="/static/img/avatar.jpg" height="75px" width="75px" /></a><h1 class="author-name"><a href="/">cryptoanarchy.wiki</a></h1><div class="profile-about"> Arise, you have nothing to lose but your barbed wire fences!</div><div class="social"><ul><li><a href="https://twitter.com/_cryptoanarchy" target="_blank"><i class="fa fa-twitter"></i></a><li><a href="https://www.facebook.com/cryptoanarchy.wiki" target="_blank"><i class="fa fa-facebook"></i></a><li><a href="https://github.com/cryptoanarchywiki" target="_blank"><i class="fa fa-github"></i></a></ul></div><hr /><ul class="sidebar-nav"> <strong>Navigation</strong><li><a href="https://cryptoanarchy.wiki">Return to cryptoanarchy.wiki</a><li><a href="/">Archive Home</a><li><a href="/archive/">Posts by Year</a><li><a href="/authors/by-posts/">Authors by Post Number</a><li><a href="/authors/notable/">Notable Authors</a></ul><hr><ul class="sidebar-nav"> <strong>Similar Resources</strong><li><a class="about" href="https://lopp.net/bitcoin.html" target="_blank">Lopp's Bitcoin Resources</a><li><a class="about" href="https://nakamotoinstitute.org/" target="_blank">Satoshi Nakamoto Institute</a><li><a class="about" href="https://www.activism.net/cypherpunk/" target="_blank">Activism.net: Cypherpunks</a></ul></div></div><div class="col-sm-8 col-offset-1 main-layout"><h1 id="1998-07-10---mixmaster-protocol">1998-07-10 - Mixmaster protocol</h1><h2 id="header-data">Header Data</h2><p>From: ulf<span>@</span>REPLAY.COM<br /> To: mix-l@jpunix.com<br /> Message Hash: a771e069ec125795bf977029a69eb89aba61e044d3f04677c74dcb1dbee011e9<br /> Message ID: &lt;199807102025.WAA06967@basement.replay.com&gt;<br /> Reply To: <em>N/A</em><br /> UTC Datetime: 1998-07-10 20:26:22 UTC<br /> Raw Date: Fri, 10 Jul 1998 13:26:22 -0700 (PDT)<br /><h2 id="raw-message">Raw message</h2><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>From: ulf@REPLAY.COM
Date: Fri, 10 Jul 1998 13:26:22 -0700 (PDT)
To: mix-l@jpunix.com
Subject: Mixmaster protocol
Message-ID: &lt;199807102025.WAA06967@basement.replay.com&gt;
MIME-Version: 1.0
Content-Type: text


I'd like to get feedback on the clarity of this draft describing the
Mixmaster protocol.

I'll post the proposed extensions for version 3 later.



Mixmaster Protocol
==================

Abstract

Most e-mail security protocols only protect the message body, leaving
useful information such as the the identities of the conversing
parties, sizes of messages and frequency of message exchange open to
adversaries. This document describes Mixmaster, a mail transfer
protocol designed to protect electronic mail against traffic analysis.


Table of Contents

1. Introduction
2. The Mix-Net Protocol
   2.1 Message Creation
   2.2 Remailing
3. Message Format
   3.1 Cryptographic Algorithms
   3.2 Packet Format
   3.2.1 Header Chart Format
   3.2.2 Body Format
   3.3 Mail Transfer Encoding
   3.5 Transfer through Socket Connections
4. Key Format
5. References


1. Introduction

This document describes a mail transfer protocol designed to protect
electronic mail against traffic analysis. Most e-mail security
protocols only protect the message body, leaving useful information
such as the the identities of the conversing parties, sizes of
messages and frequency of message exchange open to adversaries.

Message transmission can be protected against traffic analysis by the
mix-net protocol. A mix (remailer) is a service that forwards
messages, using public key cryptography to hide the correlation
between its inputs and outputs. If a message is sent through a
sequence of mixes, one trusted mix is sufficient to provide anonymity
and unobserveability of communications against a powerful
adversary. Mixmaster is a mix-net implementation for electronic mail.

This document describes version 2 of the Mixmaster message format.


2. The Mix-Net Protocol

The mix-net protocol [Chaum] allows to send messages while hiding the
relation of sender and recipient from observers (unobserveability). It
also provides the sender of a message with the ability to remain
anonymous to the recipient (sender anonymity). If anonymity is not
desired, authenticity and unobserveability can be achieved in the same
time by transmitting digitally signed messages.

This section gives an overview over the protocol used in
Mixmaster. The message format is specified in section 3.


2.1 Message Creation

To send a message, the user agent splits into parts of fixed size,
which form the bodies of Mixmaster packets. If sender anonymity is
desired, care should be taken not to include identifying information
in the message. The message may be compressed.

The sender choses a sequence of up to 20 remailers for each
packet. The final remailer must be identical for all parts of the
message.

The packet header consists of 20 charts. For a sequence of n
remailers, header charts n+1, ... , 20 are filled with random
data. For all charts i := n down to 1, the sender generates a
symmetric encryption key, which is used to encrypt the body and all
following header charts. This key, together with other control
information for the remailer, is included in the i-th header chart,
which is then encrypted with the remailer's public key.

The message is sent to the first remailer in an appropriate transport
encoding.

To increase reliability, multiple copies of message may be sent
through different paths. The final remailer must be identical for all
paths, so that duplicates can be detected and the message is delivered
only once.


2.2 Remailing

When a remailer receives a message, it decrypts the first header chart
with its private key. By keeping track of a packet ID, the remailer
verifies that the packet has not been processed before. The integrity
of the message is verified by checking the packet length and verifying
message digests included in the packet. Then the first header chart is
removed, the others are shifted up by one, and the last chart is
filled with random padding. All header charts and the message body are
decrypted with the symmetric key found in the header. This reveals a
public key-encrypted header chart for the next remailer at the top,
and obscures the old top header chart. Transfer encoding is applied to
the resulting message.

The remailer collects several encrypted messages before sending the
resulting messages in random order. Thus the relation between the
incoming and outgoing messages is obscured to outside adversaries even
if the adversary can observe all messages sent. The message is
effectively anonymized by sending it through a chain of independently
operated remailers.


2.3 Message Reassembly

When a packet is sent to the final remailer, it contains a flag
indicating that the chain ends at that remailer, and whether the
packet contains a complete message or part of a multi-part message. If
the packet contains the entire message, the body is decrypted and
after reordering messages the plain text is delivered to the
recipient. For partial messages, a packet ID is used to identify the
other parts as they arrive. When all parts have arrived, the message
is reassembled and delivered. If the parts do not arrive within a time
limit, the message is discarded.

Only the last remailer in the chain can determine whether packets are
part of a certain message. To all the others, they are completely
independent.

If necessary, the reassembled message is decompressed before sending
it to the recipient.

When anonymous messages are forwarded to third parties, the final
remailer should ensure that the sender cannot supply header lines that
indicate a false identity or send Usenet control messages that may
have security implications. Appropriate information about the origin
of the message should be inserted in the Comments: header line of the
message.

If the recipient does not wish to receive anonymous messages, the
remailer can ensure authenticity be verifying that the message is
cryptographically signed [RFC 1991, RFC 2311] by a known sender.


3. Message Format

3.1 Cryptographic Algorithms

The asymmetric encryption operation in Mixmaster version 2 uses RSA
with 1024 bit RSA keys and PKCS #1 padding [RFC 2313]. The symmetric
encryption uses EDE 3DES with cipher block chaining (24 byte key, 8
byte initialization vector) [Schneier]. MD5 [RFC 1321] is used as the
message digest algorithm.


3.2 Packet Format

A Mixmaster packet consists of a header containing information for the
remailers, and a body containing the payload. To ensure that packets
are undistinguishable, the size of these encrypted data fields is
fixed.

The packet header consists of 20 header charts (specified in section
A.2) of 512 bytes each, resulting in a total size of 10240 bytes. The
header charts and the body are encrypted with symmetric session keys
specified in the first header chart.


3.2.1 Header Chart Format

     Public key ID                [  16 bytes]
     Encrypted session key length [   1 byte ]
     RSA-encrypted session key    [ 128 bytes]
     Initialization vector        [   8 bytes]
     Encrypted header section     [ 328 bytes]
     Padding                      [  31 bytes]

Total size:
  512 bytes

A random 24 bit Triple-DES key is encrypted with RSA, resulting
in 1024 bit of encrypted data.

The header section encrypted with this session key is:

     Packet ID                     [ 16 bytes]
     Triple-DES key                [ 24 bytes]
     Packet type identifier        [  1 byte ]
     Packet type 0:
        19 Initialization vectors  [152 bytes]
        Remailer address           [ 80 bytes]
     Packet type 1:
        Message ID                 [ 16 bytes]
        Initialization vector      [  8 bytes]
     Packet type 2:
        Packet number              [  1 byte ]
        Number of packets          [  1 byte ]
        Message ID                 [ 16 bytes]
        Initialization vector      [  8 bytes]
     Timestamp                     [  7 bytes] (optional)
     Message digest                [ 16 bytes]

Total size:
  Type 0: 297 bytes (+ 7 if timestamp is used)
  Type 1:  81 bytes (+ 7 if timestamp is used)
  Type 2:  83 bytes (+ 7 if timestamp is used)

This data structure is padded to 328 bytes.

Packet ID: randomly generated packet identifier.

Key: symmetric key used to encrypt the following header charts and the
body.

Packet type identifier:

Intermediate hop           0
Final hop                  1
Final hop, partial message 2

Initialization vectors: For packet type 1 and 2, the IV is used to
symmetrically encrypt the body. For packet type 0, there is one IV for
each of the 19 following header charts. The IV for 19th header chart
is also used for the body.

Remailer address: address of next hop.

Message ID: randomly generated identifier unique to (all packets of)
this message.

Packet number: Sequence number used in multi-packet messages.

Number of packets: Total number of packets.

Timestamp: A timestamp is introduced with the byte sequence (48, 48,
48, 48, 0). The following two bytes specify the number of days since
Jan 1, 1970, given in little-endian byte order. A random number of up
to 3 may be substracted from the number of days in order to obscure
the origin of the message.

Digest: MD5 digest computed over the preceding elements of the
encrypted header section.

Header charts 2 .. 20 and the body each are decrypted separately using
the respective initialization vectors.


3.2.2 Body Format

     Number of destinations     [        1 byte]
     Destination addresses      [ 80 bytes each]
     Number of header lines     [        1 byte]
     Header lines               [ 80 bytes each]
     Payload                    [      any size]

Destination addresses are Internet mail addresses. Additionally,
the following special destinations are defined:

null:             Dummy message, will be discarded by the final mix.
post: newsgroup   Message will be posted to Usenet.

The payload may be compressed using GZIP [RFC 1952] if the
capabilities attribute of the final remailer contains the flag
"C". When compressing the message, the operating system field must be
set to Unix, and file names must not be given. The remailer treats
messages beginning with the GZIP identification header (31, 139) as
compressed.

The resulting message is split into chunks of 10236 bytes. To each chunk,
its length is prepended as a 4 byte little-endian number to form the body
of a Mixmaster packet.


3.3 Mail Transfer Encoding

Mixmaster packets are sent as text messages [RFC 822]. The body has
the following format:

  ::
  Remailer-Type: Mixmaster [version number]
  
  -----BEGIN REMAILER MESSAGE-----
  [message length]
  [message digest]
  [encoded message]
  -----END REMAILER MESSAGE-----

The length field always contains the decimal number "20480", since the
size of Mixmaster messages is constant. The MD5 message digest [RFC
1321] of the message is encoded as a hexadecimal string.

The message itself is encoded in base 64 encoding [RFC 1421] and
broken into lines of 40 characters.


4. Key Format

Remailer public key files consist of a list of attributes and a
public RSA key:

  [attributes list]
  
  -----Begin Mix Key-----
  [key ID]
  [length]
  [encoded key]
  -----End Mix Key-----

The attributes are listed in one line separated by spaces:

identifier:   a human readable alphabetical string identifiying the remailer
address:      the remailer's Internet mail address
key ID:       public key ID
version:      the Mixmaster version number
capabilities: flags indicating additional capabilites of the remailers

The identifier consists of alphanumeric characters, begining with an
alphabetic character. It must not contain whitespace.

The encoded key packet consists of two bytes specfying the key length
(1024 bits) in little-endian byte order, and of the RSA modulus and
the public exponent in big-endian form using 128 bytes each, with
preceding null bytes where necessary. The packet is encoded in base
64, and broken into lines of 40 characters each. Its length (258
bytes) is given as a decimal number.

The key ID is the MD5 message digest of the reprentation of the RSA
public key (not including the length bytes). It is encoded as a
hexadecimal string.

The capabilities field is optional. Clients should ignore unknown flags.
The following flags are used in version 2.0.4:

C     accepts compressed messages.
M     will forward messages to another mix, when used as the final hop.
Nm    supports posting to Usenet throught a mail-to-news gateway.
Np    supports direct posting to Usenet.

Digital signatures [RFC 1991] should be used to ensure the
authenticity of the key files.


5. References

[Chaum] Chaum, D., "Untraceable Electronic Mail, Return Addresses, and
Digital Pseudonyms", Communications of the ACM 24 (1981) 2.

[RFC 822] Crocker, D., "Standard for the Format of ARPA Internet Text
Messages", STD 11, RFC 822, August 1982.

[RFC 1321] Rivest, R., "The MD5 Message-Digest Algorithm", RFC 1321,
April 1992.

[RFC 1421] Linn, J., "Privacy Enhancement for Internet Electronic
Mail: Part I -- Message Encryption and Authentication Procedures", RFC
1421, February 1993.

[RFC 1952] Deutsch, P., "GZIP file format specification version 4.3",
RFC 1951, May 1996.

[RFC 1991] Atkins, D., Stallings, W. and Zimmermann, P., "PGP Message
Exchange Formats", RFC 1991, August 1996.

[RFC 2311] Dusse, S., Hoffman, P, Ramsdell, B, Lundblade, L. and
Repka, L., "S/MIME Version 2 Message Specification", RFC 2311, March
1998.

[RFC 2313] Kaliski, B., "PKCS #1: RSA Encryption, Version 1.5", RFC
2313, March 1998.

[Schneier] Schneier, B., "Applied Cryptography", 2nd Edition, Wiley,
1996.






</code></pre></div></div><h2 id="thread">Thread</h2><ul><li><p>Return to <a href="/archive/1998/07">July 1998</a><li><p>Return to “<a href="/author/ulf_at_replay_com">ulf<span>@</span>REPLAY.COM</a>”<li><p>1998-07-10 (Fri, 10 Jul 1998 13:26:22 -0700 (PDT)) - Mixmaster protocol - <em>ulf@REPLAY.COM</em></ul><footer> - <a href="https://github.com/cryptoanarchywiki/mailing-list-archive">https://github.com/cryptoanarchywiki/mailing-list-archive</a></footer></div></div><script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script> <script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script> <script src="/static/js/bootstrap.min.js"></script> <script src="/static/js/super-search.js"></script> <script src="/static/js/thickbox-compressed.js"></script> <script src="/static/js/projects.js"></script>
