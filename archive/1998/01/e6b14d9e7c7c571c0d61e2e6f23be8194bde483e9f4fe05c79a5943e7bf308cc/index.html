<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="shortcut icon" href="/static/img/favicons/favicon.ico" /><link rel="apple-touch-icon" sizes="57x57" href="/static/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/static/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/static/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/static/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/static/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/static/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/static/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/static/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/static/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/static/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/static/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/static/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/static/img/favicons/favicon-16x16.png"><link rel="manifest" href="/manifest.json"><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><title>cryptoanarchy.wiki - Cypherpunks Mailing List Archive</title><meta name="author" content="cryptoanarchy.wiki" /><meta name="description" content="E6b14d9e7c7c571c0d61e2e6f23be8194bde483e9f4fe05c79a5943e7bf308cc" /><meta name="keywords" content="E6b14d9e7c7c571c0d61e2e6f23be8194bde483e9f4fe05c79a5943e7bf308cc, cryptoanarchy.wiki - Cypherpunks Mailing List Archive, " /><link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml"><meta content="" property="fb:app_id"><meta content="cryptoanarchy.wiki - Cypherpunks Mailing List Archive" property="og:site_name"><meta content="E6b14d9e7c7c571c0d61e2e6f23be8194bde483e9f4fe05c79a5943e7bf308cc" property="og:title"><meta content="article" property="og:type"><meta content="Arise, you have nothing to lose but your barbed wire fences!" property="og:description"><meta content="http://localhost:4000/archive/1998/01/e6b14d9e7c7c571c0d61e2e6f23be8194bde483e9f4fe05c79a5943e7bf308cc/" property="og:url"><meta content="2018-06-27T00:58:45+02:00" property="article:published_time"><meta content="http://localhost:4000/about/" property="article:author"><meta content="http://localhost:4000/static/img/avatar.jpg" property="og:image"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@_cryptoanarchy"><meta name="twitter:creator" content="@_cryptoanarchy"><meta name="twitter:title" content="E6b14d9e7c7c571c0d61e2e6f23be8194bde483e9f4fe05c79a5943e7bf308cc"><meta name="twitter:url" content="http://localhost:4000/archive/1998/01/e6b14d9e7c7c571c0d61e2e6f23be8194bde483e9f4fe05c79a5943e7bf308cc/"><meta name="twitter:description" content="Arise, you have nothing to lose but your barbed wire fences!"><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous"><link rel="stylesheet" href="/static/css/syntax.css"><link href="/static/css/bootstrap.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Roboto+Condensed:400,300italic,300,400italic,700&amp;subset=latin,latin-ext" rel="stylesheet" type="text/css"><link rel="stylesheet" href="/static/css/super-search.css"><link rel="stylesheet" href="/static/css/thickbox.css"><link rel="stylesheet" href="/static/css/projects.css"><link rel="stylesheet" href="/static/css/main.css"><body><div class="container"><div class="col-sm-3"><div class="fixed-condition"> <a href="/"><img class="profile-avatar" src="/static/img/avatar.jpg" height="75px" width="75px" /></a><h1 class="author-name"><a href="/">cryptoanarchy.wiki</a></h1><div class="profile-about"> Arise, you have nothing to lose but your barbed wire fences!</div><div class="social"><ul><li><a href="https://twitter.com/_cryptoanarchy" target="_blank"><i class="fa fa-twitter"></i></a><li><a href="https://www.facebook.com/cryptoanarchy.wiki" target="_blank"><i class="fa fa-facebook"></i></a><li><a href="https://github.com/cryptoanarchywiki" target="_blank"><i class="fa fa-github"></i></a></ul></div><hr /><ul class="sidebar-nav"> <strong>Navigation</strong><li><a href="https://cryptoanarchy.wiki">Return to cryptoanarchy.wiki</a><li><a href="/">Archive Home</a><li><a href="/archive/">Posts by Year</a><li><a href="/authors/by-posts/">Authors by Post Number</a><li><a href="/authors/notable/">Notable Authors</a></ul><hr><ul class="sidebar-nav"> <strong>Similar Resources</strong><li><a class="about" href="https://lopp.net/bitcoin.html" target="_blank">Lopp's Bitcoin Resources</a><li><a class="about" href="https://nakamotoinstitute.org/" target="_blank">Satoshi Nakamoto Institute</a><li><a class="about" href="https://www.activism.net/cypherpunk/" target="_blank">Activism.net: Cypherpunks</a></ul></div></div><div class="col-sm-8 col-offset-1 main-layout"><h1 id="1998-01-27---information-on-key-handling-with-microsoft-products-fwd">1998-01-27 - Information on key handling with Microsoft products (fwd)</h1><h2 id="header-data">Header Data</h2><p>From: Ray Arachelian &lt;sunder<span>@</span>sundernet.com&gt;<br /> To: cypherpunks &lt;cypherpunks@toad.com<br /> Message Hash: e6b14d9e7c7c571c0d61e2e6f23be8194bde483e9f4fe05c79a5943e7bf308cc<br /> Message ID: &lt;Pine.SUN.3.96.980127135417.15074B-100000@beast.brainlink.com&gt;<br /> Reply To: <em>N/A</em><br /> UTC Datetime: 1998-01-27 18:56:58 UTC<br /> Raw Date: Wed, 28 Jan 1998 02:56:58 +0800<br /><h2 id="raw-message">Raw message</h2><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>From: Ray Arachelian &lt;sunder@sundernet.com&gt;
Date: Wed, 28 Jan 1998 02:56:58 +0800
To: cypherpunks &lt;cypherpunks@toad.com
Subject: Information on key handling with Microsoft products (fwd)
Message-ID: &lt;Pine.SUN.3.96.980127135417.15074B-100000@beast.brainlink.com&gt;
MIME-Version: 1.0
Content-Type: text/plain




&gt; There's been some discussion recently on this news alias about how
&gt; Microsoft
&gt; handles key management (and some related topics) in CryptoAPI (more
&gt; specifically, the Microsoft base CSPs). Below is a document we've put
&gt; together to help answer these questions.
&gt;
&gt; Thanks,
&gt; -JasonG
&gt;
&gt; Product Manager, Windows NT Security
&gt; Microsoft Corporation
&gt;
&gt;
&gt;
&gt; Microsoft's Response to Recent Questions on the Recovery
&gt; of Private Keys from various Microsoft Products
&gt;
&gt; Recently, there has been discussion on some Internet forums about the
&gt; methods Microsoft uses to store private keys in some of its products, as
&gt; well as about CryptoAPI's role in key management. These discussions
&gt; included
&gt; some inaccurate information about the PFX and PKCS-12 formats, as well as
&gt; how Microsoft implements these formats in its products.
&gt;
&gt; This paper was prepared by the Microsoft Public Key Infrastructure team to
&gt; provide some additional insight and clarification on these issues, and in
&gt; some cases, identify long-term plans that Microsoft has to continue the
&gt; improvement of security in our products.
&gt;
&gt; CryptoAPI
&gt; One area to clarify at the outset is the role of CryptoAPI. Implications
&gt; that any key management problem on Microsoft's Internet products would be
&gt; an
&gt; example of fundamental problems with CryptoAPI are absolutely inaccurate.
&gt; CryptoAPI is a set of cryptographic technologies that are provided for use
&gt; by other software--sort of a cryptographic toolbox. The actual
&gt; cryptographic
&gt; functions are provided through Cryptographic Service Providers (CSPs),
&gt; which
&gt; are implemented as DLLs. With the exception of the details about a
&gt; possible
&gt; PKCS-12 attack, all the issues raised in the recent discussions are
&gt; specifically aimed at Microsoft's base CSPs, not at CryptoAPI.  The base
&gt; CSPs are the royalty-free, software-based CSPs provided with Windows NT
&gt; 4.0,
&gt; Windows 95, and Internet Explorer. These attacks do not apply in general
&gt; to
&gt; other CryptoAPI CSPs and do not indicate any fundamental concerns with the
&gt; security of the CryptoAPI architecture or applications built upon it.
&gt;
&gt; PFX/PKCS-12
&gt; Microsoft products do not "store" private key material using PKCS-12,
&gt; contrary to recent descriptions on the Internet. For clarification,
&gt; PKCS-12
&gt; is a standard format, used for export/import of Public Key Certificates
&gt; and
&gt; related key material.  At present, the only Microsoft product that
&gt; supports
&gt; use of this format is Microsoft Internet Explorer 4.x.  Internet Explorer
&gt; uses PKCS-12 solely as a means of migrating  a user's Certificate and
&gt; public-private key pair between multiple Internet Explorer installations
&gt; or
&gt; between Internet Explorer and other products, such as Netscape
&gt; Communicator.
&gt;
&gt;
&gt; Some background might help. Microsoft originally developed the draft
&gt; specification for an encrypted export/import format, referred to as PFX,
&gt; but
&gt; the PFX specification was never implemented by Microsoft.  Instead, the
&gt; PFX
&gt; specification was handed over to RSA Labs and it became the draft PKCS-12
&gt; specification.  The design was then reviewed, and contributed to, by a
&gt; number of other companies to arrive at the current PKCS-12 standard.
&gt; Microsoft and Netscape have both implemented PKCS-12 with 40-bit
&gt; encryption.
&gt; This was done to provide a common, exportable solution that was completely
&gt; interoperable.
&gt;
&gt; The example of breaking a PKCS-12 data blob, which was given in discussion
&gt; on the Internet, is not an attack on the "weak" cryptography of PKCS-12.
&gt; Rather, it is simply a dictionary attack (long known and well understood
&gt; in
&gt; cryptography), which works well if people use poorly-chosen passwords to
&gt; protect the PKCS-12 data blob. Examples of such bad passwords include
&gt; words
&gt; in the English dictionary.  In our implementation of PKCS-12, we could
&gt; possibly do some things to make brute-force attack against an exported
&gt; PKCS-12 data blob more difficult. For example, performing a dictionary
&gt; check
&gt; on the password before accepting it for encrypting the data blob would
&gt; reduce the use of weak passwords. Alternatively, we could  iterate the
&gt; setup
&gt; function to increase "diversity" making it much more expensive for an
&gt; attacker to search. However, neither of these methods are required for
&gt; protection of the data blob. Good security is always a combination of
&gt; technology and policy. As part of a strong security policy, strong
&gt; passwords
&gt; should be used on all resources. The Microsoft Security Advisor website
&gt; (http://www.microsoft.com/security) has some guidelines for choosing
&gt; strong
&gt; passwords.
&gt;
&gt; One statement by the original poster argues that Microsoft managed to
&gt; design
&gt; a security format that actually makes it easier to break into the
&gt; protected
&gt; data. As stated above, a number of well respected companies were involved
&gt; extensively in the design and review of PKCS-12 before it became a
&gt; standard.
&gt; An iteration count, which would make the type of attack described above
&gt; more
&gt; difficult (in terms of time), was added late in the PKCS-12 evolution.  It
&gt; was, however, too late to make it into the Internet Explorer 4 product
&gt; release. Future versions of Internet Explorer will include support for the
&gt; an iteration count, further strengthening the security of exported key
&gt; material.
&gt;
&gt; Of course, in general the PKCS-12 data objects will not be available on a
&gt; user's machine, since they are only used by Internet Explorer 4.x when
&gt; exporting key material to, or importing key material from another system.
&gt; As
&gt; with any sensitive data, users should take care when working PKCS-12 data
&gt; blobs and not leave them on their hard drives.
&gt;
&gt; Exploiting Internet Explorer
&gt; One of the fundamental requirements to perform any possible cryptographic
&gt; attack discussed in the recent postings is the assumption that a malicious
&gt; entity could somehow access to data on a user's computer system, without
&gt; the
&gt; permission or knowledge of the user.  This is a large leap of faith.
&gt; Users
&gt; that are using Public Key Certificates today are generally sophisticated
&gt; and
&gt; savvy users, or part of a larger corporate infrastructure with
&gt; knowledgeable
&gt; administrators. This class of users will certainly keep abreast of current
&gt; security issues and install security-related patches and updates as they
&gt; become available. Microsoft has been extremely responsive in dealing with
&gt; all known Internet Explorer security attacks and has posted patches for
&gt; all
&gt; currently known attacks. And, of course, security issues are certainly not
&gt; limited to Microsoft software.
&gt;
&gt; Information on security-related issues with Microsoft products is
&gt; available
&gt; on the Microsoft Security Advisor website at
&gt; http://www.microsoft.com/security.
&gt;
&gt; Attacks against Authenticode signing keys
&gt; Another concern identified was that if a malicious hacker could steal a
&gt; user's or company's Authenticode signing key, that hacker could sign
&gt; objects
&gt; with that key and distribute them. Then when other users tried to download
&gt; the signed object, they would think the key's owner really signed the
&gt; object, which might contain malicious code. The Authenticode program has
&gt; been designed to ensure that only trusted programs are allowed to run on a
&gt; users machine. As stated earlier Microsoft has been very responsive is
&gt; addressing security issues with IE.
&gt;
&gt; However, it is extremely unlikely anyone could be successful with a
&gt; simplistic strategy for stealing Authenticode signing keys and then using
&gt; them.  As noted above, there are security patches already released for
&gt; known
&gt; Internet Explorer bugs that could possibly allow a key blob to be stolen
&gt; off
&gt; a user's hard disk (assuming a user left an Authenticode 'key' file on
&gt; their
&gt; hard disk).   Second, anyone signing code using Authenticode technology is
&gt; extremely unlikely to leave their key material sitting on an end user
&gt; machine routinely used for browsing the Internet.
&gt;
&gt; Microsoft recommends storing key material, such as that used in
&gt; Authenticode, in hardware tokens. Such tokens prevent any of these attacks
&gt; from getting started as the keys are not stored in the PC and are not
&gt; exportable.  The Authenticode signing keys that Microsoft uses for all our
&gt; software, for instance, are stored in such a physical hardware key storage
&gt; mechanism.
&gt;
&gt; Attacks on Encrypted Key material
&gt; There is some confusion over the algorithms and methods that Microsoft
&gt; uses
&gt; to provide protection of encrypted key material in Internet Explorer when
&gt; using the standard Microsoft base CSPs. There were changes between
&gt; Internet
&gt; Explorer 3.0x and Internet Explorer 4.x specifically to address any
&gt; possible
&gt; concern. Note, this concern is unlikely to be valid for any third-party
&gt; software CSP and is not relevant to hardware CSPs.
&gt;
&gt; Microsoft is constantly working to improve the security of our products.
&gt; We
&gt; determined that there were better suited methods for storing keys than
&gt; using
&gt; the RSA RC4 stream cipher algorithm used in Internet Explorer 3.0x.  In
&gt; particular, a stream cipher, such as RC4, is not ideally suited for this
&gt; particular use because it can be susceptible to a "known-keystream
&gt; attack".
&gt; In a known-keystream attack, if you know the plain text, which you
&gt; arguably
&gt; might be able to determine given the number of standard PKCS-8 fields, you
&gt; can recover the keystream.  If you recover the keystream, then a XOR
&gt; function will indeed decrypt anything else encrypted with the same key.
&gt; However, Microsoft only used this RC4-based implementation in the base
&gt; CSPs
&gt; that shipped with Internet Explorer 3.0x.  The CSPs that shipped in
&gt; Internet
&gt; Explorer 4.x protect private key material in a form that is encrypted
&gt; using
&gt; DES, which is a block cipher and is not susceptible to the known-keystream
&gt; attack that can be used against RC4.
&gt;
&gt; Again, note that this kind of attack assumes some degree of security
&gt; breach
&gt; on the user's system such that the keystream could be obtained.
&gt;
&gt; Key export attacks
&gt; The original Internet posting raises concern about the CryptoAPI interface
&gt; CryptExportKey().  This function is fully documented and does indeed
&gt; export
&gt; private key material in an encrypted format.  The presence of the
&gt; CryptExportKey() function is to support functionality such as migrating
&gt; key
&gt; material between machines for a user or creating a backup copy of a key.
&gt; It
&gt; should be noted however, that many CSPs, including most hardware based
&gt; CSPs,
&gt; do not allow exportable private keys and will return and error in response
&gt; to a CryptExportKey() request.
&gt;
&gt; Also, Microsoft's base software CSPs provide a means to mark keys as
&gt; non-exportable when they are generated.  An additional security protection
&gt; is provided if the flag CRYPT_USER_PROTECTED is set, in which case each
&gt; use
&gt; of the private key, including export, requires the user to supply a
&gt; password
&gt; to access the key.  Some commercial CAs are not currently setting this
&gt; flag
&gt; and do not provide the user a way to request it during Certificate
&gt; enrollment.  We recognize this as a problem.  We will continue working
&gt; with
&gt; CAs to assist them in supporting these security features.  However, we
&gt; will
&gt; also make available a utility to allow setting this flag after key
&gt; generation for users concerned with this type of attack.
&gt;
&gt; The posting also asserts that an ActiveX control could be downloaded from
&gt; a
&gt; web page, simply ask for the current users key, ship the key off for
&gt; collection by an unscrupulous person, and then delete itself without a
&gt; trace.
&gt;
&gt; If users run unsigned code, or code from an unknown origin, a number of
&gt; unpleasant things can happen.  This could indeed occur if the key as been
&gt; marked exportable and the CRYPT_USER_PROTECTED flag is not set. However,
&gt; such a scenario assumes that the user follows few or no policies with
&gt; regard
&gt; to good security, such as running code from unknown sources. Similarly, if
&gt; the user were running software from unknown/untrusted sources, that
&gt; software
&gt; could reformat their hard drive, or manipulate other user data. This
&gt; concept
&gt; is certainly not new.
&gt;
&gt; There was also discussion of 16 dialog boxes appearing to the user for
&gt; their
&gt; password if the CRYPT_USER_PROTECTED flag is set. Certainly asking the
&gt; user
&gt; too many times would be better than too few times, however in our tests,
&gt; under extreme (and uncommon cases), a user might be asked for their
&gt; password
&gt; at most four times when a key is used with the Microsoft base CSPs.
&gt; Perhaps
&gt; the claim came from an early beta release.
&gt;
&gt; ----------------------------------------------------------------
&gt; Users Guide http://www.microsoft.com/sitebuilder/resource/mailfaq.asp
&gt; contains important info including how to unsubscribe.  Save time, search
&gt; the archives at http://microsoft.ease.lsoft.com/archives/index.html






</code></pre></div></div><h2 id="thread">Thread</h2><ul><li><p>Return to <a href="/archive/1998/01">January 1998</a><li><p>Return to “<a href="/authors/ray_arachelian_sunder_at_sundernet_com_">Ray Arachelian &lt;sunder<span>@</span>sundernet.com&gt;</a>”<li><p>1998-01-27 (Wed, 28 Jan 1998 02:56:58 +0800) - Information on key handling with Microsoft products (fwd) - <em>Ray Arachelian &lt;sunder@sundernet.com&gt;</em></ul><footer> - <a href="https://github.com/cryptoanarchywiki/mailing-list-archive">https://github.com/cryptoanarchywiki/mailing-list-archive</a></footer></div></div><script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script> <script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script> <script src="/static/js/bootstrap.min.js"></script> <script src="/static/js/super-search.js"></script> <script src="/static/js/thickbox-compressed.js"></script> <script src="/static/js/projects.js"></script>
